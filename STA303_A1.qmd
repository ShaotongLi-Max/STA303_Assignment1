---
title: "Modeling Family Size: Literacy and Marriage Age in Rural Portugal"
subtitle: "A Generalized Linear Model Approach"
author: 
  - Shaotong (Max) Li
date: 2024/11/17
date-format: long
abstract: ""
number-sections: true
format: pdf
---

```{r}
#| include: false
#| warning: false
#| message: false
#| echo: false

install.packages(c("ggplot2", "MASS", "dplyr"))

library(ggplot2)  
library(MASS)    
library(dplyr)    


# Load data
load("portugal.RData")

# Define family size
portugal$family_size <- portugal$children + 2

# Ensure monthsSinceM is treated as a numeric variable
portugal$monthsSinceM <- as.numeric(portugal$monthsSinceM)  

# Normal Regression Model (Gaussian)
normal_model <- glm(
  family_size ~ ageMarried + literacy + monthsSinceM,
  data = portugal,
  family = gaussian(link = "identity") 
)

# Define large family as binary variable
portugal$large_family <- ifelse(portugal$family_size > 5, 1, 0)

# Binomial Logistic Regression Model
binomial_model <- glm(
  large_family ~ ageMarried + literacy + monthsSinceM,
  data = portugal,
  family = binomial(link = "logit") 
)

# Poisson Regression Model
poisson_model <- glm(
  family_size ~ ageMarried + literacy + monthsSinceM,
  data = portugal,
  family = poisson(link = "log")  
)

# Gamma Regression Model
gamma_model <- glm(
  family_size ~ ageMarried + literacy + monthsSinceM,
  data = portugal,
  family = Gamma(link = "log") 
)

# Generate predictions for all models
portugal <- portugal %>%
  mutate(
    pred_normal = predict(normal_model, type = "response"),
    pred_binomial = predict(binomial_model, type = "response") * max(family_size),  
    pred_poisson = predict(poisson_model, type = "response"),
    pred_gamma = predict(gamma_model, type = "response")
  )

```

# Introduction

Understanding the factors influencing family size is of paramount importance in demographic research, as family size has significant implications for economic development, resource allocation, and population growth. In rural areas, where socioeconomic conditions often shape family dynamics, investigating the determinants of family size is especially relevant. Portugal in the late 20th century, characterized by pronounced economic disparities and relatively low levels of education, provides an intriguing context for studying these dynamics. Rural Portugal, in particular, exhibited distinct family patterns shaped by varying levels of literacy and cultural norms surrounding marriage, making it an ideal setting to explore these relationships.

Education is widely recognized as a key determinant of family size, operating through both direct and indirect pathways. Studies have demonstrated that higher levels of education are strongly correlated with smaller family sizes, as education expands access to information about family planning, increases participation in the labor force, and delays the timing of marriage. The impact of education on family size is nuanced: while the direct effects are more evident at lower levels of education, indirect effects, such as those mediated through labor force participation and age at marriage, become increasingly significant at higher education levels, particularly for women. Furthermore, these effects are often asymmetrical between genders, with the wife’s education playing a more dominant role in shaping family outcomes than the husband’s education.

The complex interplay between literacy, age at marriage, and family size highlights the need for targeted statistical analysis to disentangle these relationships. Using data from a fertility survey conducted in rural Portugal in 1979, this study aims to model the effects of literacy and marriage age on family size through the application of generalized linear models (GLMs). This approach not only facilitates the estimation of direct effects but also enables the identification of additional variation in birth rates after accounting for known explanatory variables. The findings from this study will contribute to the broader understanding of demographic behavior in rural settings and provide insights into the socioeconomic determinants of family size that remain relevant for contemporary policy planning.

# Methods

## Clean Data Process

In this study, we began by carefully selecting the variables most relevant to our research question: understanding how literacy and marriage age affect family size in rural Portugal. From the dataset, we identified three key variables:

children (Numerical): This variable represents the number of children in a family and serves as the basis for calculating the dependent variable, family_size.

ageMarried (Categorical): This variable captures the marriage age of individuals, categorized into meaningful intervals: 0to15, 15to18, 18to20, 20to22, 22to25, 25to30, and 30toInf. It reflects the social and demographic variation in marriage age and is included as an independent variable in the model.

literacy (Binary): A factor variable indicating whether an individual is literate (yes) or not (no). This variable is included as a second independent variable, as literacy is hypothesized to influence family planning and size.

To address our research objective, the children variable was transformed to create a new variable, family_size, defined as the total number of children in a family plus two. This transformation assumes a baseline family size of two individuals (e.g., parents) and ensures consistency in defining the dependent variable.

## Generalized Linear Models

### Normal Distribution Model

```{=tex}
\begin{equation}
\text{Model 1 (Normal Regression): } \text{family\_size} = \beta_1 \cdot \text{ageMarried} + \beta_2 \cdot \text{literacy} + \beta_3 \cdot \text{monthsSinceM} + \beta_0
\label{eq:normal_model}
\end{equation}

\noindent
where:
\begin{itemize}
    \item $\text{ageMarried}$ is a categorical variable representing different marriage age groups.
    \item $\text{literacy} \in \{\text{yes}, \text{no}\}$, indicating whether an individual is literate.
    \item $\text{monthsSinceM} \in \mathbb{R}^{+}$ represents the number of months since marriage (a continuous variable).
    \item $\beta_1$, $\beta_2$, and $\beta_3$ are the coefficients for the independent variables.
    \item $\beta_0$ is the intercept term.
    \item This model assumes $\text{family\_size}$ follows a normal distribution.
\end{itemize}

```
### Binomial Distribution Model

```{=tex}
\begin{equation}
\text{Model 2 (Binomial Regression): } \log \left( \frac{P(\text{large\_family} = 1)}{1 - P(\text{large\_family} = 1)} \right) = \beta_1 \cdot \text{ageMarried} + \beta_2 \cdot \text{literacy} + \beta_3 \cdot \text{monthsSinceM} + \beta_0
\label{eq:binomial_model}
\end{equation}

\noindent
where:
\begin{itemize}
    \item $\text{large\_family} \in \{0, 1\}$, where 1 indicates a family size greater than 5.
    \item $\text{ageMarried}$ is a categorical variable representing different marriage age groups.
    \item $\text{literacy} \in \{\text{yes}, \text{no}\}$, indicating whether an individual is literate.
    \item $\text{monthsSinceM} \in \mathbb{R}^{+}$ represents the number of months since marriage (a continuous variable).
    \item $\beta_1$, $\beta_2$, and $\beta_3$ are the coefficients for the independent variables.
    \item $\beta_0$ is the intercept term.
    \item The dependent variable follows a binomial distribution.
    \item The logit function transforms probabilities into a linear function of the predictors.
\end{itemize}

```
### Poisson Distribution Model

```{=tex}
\begin{equation}
\text{Model 3 (Poisson Regression): } \log(\mu) = \beta_1 \cdot \text{ageMarried} + \beta_2 \cdot \text{literacy} + \beta_3 \cdot \text{monthsSinceM} + \beta_0
\label{eq:poisson_model}
\end{equation}

\noindent
where:
\begin{itemize}
    \item $\mu = E(\text{family\_size})$ represents the expected family size.
    \item $\text{ageMarried}$ is a categorical variable representing different marriage age groups.
    \item $\text{literacy} \in \{\text{yes}, \text{no}\}$, indicating whether an individual is literate.
    \item $\text{monthsSinceM} \in \mathbb{R}^{+}$ represents the number of months since marriage (a continuous variable).
    \item $\beta_1$, $\beta_2$, and $\beta_3$ are the coefficients for the independent variables.
    \item $\beta_0$ is the intercept term.
    \item This model assumes $\text{family\_size}$ follows a Poisson distribution.
    \item The log-link function ensures positive expected values.
\end{itemize}

```
### Gamma Distribution Model

```{=tex}
\begin{equation}
\text{Model 4 (Gamma Regression): } \log(\mu) = \beta_1 \cdot \text{ageMarried} + \beta_2 \cdot \text{literacy} + \beta_3 \cdot \text{monthsSinceM} + \beta_0
\label{eq:gamma_model}
\end{equation}

\noindent
where:
\begin{itemize}
    \item $\mu = E(\text{family\_size})$ represents the expected family size.
    \item $\text{ageMarried}$ is a categorical variable representing different marriage age groups.
    \item $\text{literacy} \in \{\text{yes}, \text{no}\}$, indicating whether an individual is literate.
    \item $\text{monthsSinceM} \in \mathbb{R}^{+}$ represents the number of months since marriage (a continuous variable).
    \item $\beta_1$, $\beta_2$, and $\beta_3$ are the coefficients for the independent variables.
    \item $\beta_0$ is the intercept term.
    \item This model assumes $\text{family\_size}$ follows a Gamma distribution.
    \item The log-link function ensures positive expected values.
\end{itemize}

```
# Result

## Normal Distribution Model

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.pos="H"}

plot_normal <- ggplot() +
  geom_density(aes(x = portugal$family_size, color = "Actual"), size = 1.2) +
  geom_density(aes(x = portugal$pred_normal, color = "Predicted"), size = 1.2) +
  labs(title = "Normal Regression: Prediction vs Actual",
       x = "Family Size",
       y = "Density",
       color = "Legend") +
  theme_minimal()

print(plot_normal)

```

## Binomial Distribution Model

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.pos="H"}
plot_binomial <- ggplot() +
  geom_density(aes(x = portugal$family_size, color = "Actual"), size = 1.2) +
  geom_density(aes(x = portugal$pred_binomial, color = "Predicted"), size = 1.2) +
  labs(title = "Binomial Regression: Prediction vs Actual",
       x = "Family Size",
       y = "Density",
       color = "Legend") +
  theme_minimal()

print(plot_binomial)

```

## Poisson Distribution Model

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.pos="H"}

plot_poisson <- ggplot() +
  geom_density(aes(x = portugal$family_size, color = "Actual"), size = 1.2) +
  geom_density(aes(x = portugal$pred_poisson, color = "Predicted"), size = 1.2) +
  labs(title = "Poisson Regression: Prediction vs Actual",
       x = "Family Size",
       y = "Density",
       color = "Legend") +
  theme_minimal()

print(plot_poisson)

```

## Gamma Distribution Model

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.pos="H"}

plot_gamma <- ggplot() +
  geom_density(aes(x = portugal$family_size, color = "Actual"), size = 1.2) +
  geom_density(aes(x = portugal$pred_gamma, color = "Predicted"), size = 1.2) +
  labs(title = "Gamma Regression: Prediction vs Actual",
       x = "Family Size",
       y = "Density",
       color = "Legend") +
  theme_minimal()

print(plot_gamma)


```

# Conclusion
